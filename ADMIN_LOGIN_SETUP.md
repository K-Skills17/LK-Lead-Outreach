# ğŸ” Admin Login Setup Guide

## âœ… Admin Credentials

**Email**: contato@lkdigital.org  
**Password**: K5h3s2#195962

---

## ğŸš€ Setup Instructions

### Step 1: Run Database Migrations

Go to your **Supabase Dashboard** â†’ **SQL Editor** and run these migrations in order:

#### 1. Analytics Tables (if not already done)
```sql
-- Run: supabase/migrations/003_analytics_tracking.sql
-- Run: supabase/migrations/004_analytics_functions.sql
```

#### 2. Admin Users Table
```sql
-- Run: supabase/migrations/005_admin_users.sql
```

This creates the `admin_users` table.

---

### Step 2: Create Admin User

Copy and paste this SQL into **Supabase SQL Editor** and run it:

```sql
-- Insert Admin User with hashed password
INSERT INTO admin_users (email, password_hash, name)
VALUES (
  'contato@lkdigital.org',
  '$2b$10$i8mvMn2XPOH314J2HYfVqueN8Fu0AqHTW0V60PiKA9N53tz9zefAC',
  'Admin LK Digital'
)
ON CONFLICT (email) 
DO UPDATE SET 
  password_hash = EXCLUDED.password_hash,
  name = EXCLUDED.name;
```

**Note**: This SQL was generated by `scripts/setup-admin.js` and includes the properly hashed password for `K5h3s2#195962`.

---

### Step 3: Access Admin Dashboard

1. Go to: `https://yourdomain.com/admin` (or `http://localhost:3000/admin` for local)

2. Login with:
   - **Email**: contato@lkdigital.org
   - **Password**: K5h3s2#195962

3. âœ… You're in! The dashboard will show all analytics data.

---

## ğŸ”„ How It Works

### Authentication Flow:

1. **Login Page** (`/admin`)
   - Email/password form
   - Beautiful modern UI

2. **POST to `/api/admin/login`**
   - Verifies email exists in `admin_users` table
   - Uses bcrypt to verify password hash
   - Generates session token
   - Returns token to client

3. **Session Storage**
   - Token saved in `sessionStorage`
   - Persists until browser closes
   - Used for all API requests

4. **Protected Analytics API**
   - Requires `Authorization: Bearer {token}` header
   - Validates token before returning data

---

## ğŸ”’ Security Features

âœ… **Password Hashing**: bcrypt with 10 salt rounds  
âœ… **No Plain Text**: Passwords never stored in plain text  
âœ… **Session Tokens**: Unique tokens generated per login  
âœ… **RLS Enabled**: Row Level Security on all tables  
âœ… **Email Validation**: Server-side email format checking  
âœ… **Error Messages**: Generic errors to prevent email enumeration  

---

## ğŸ‘¥ Adding More Admin Users

### Option 1: Using Supabase SQL Editor

```sql
-- Generate password hash first using bcrypt
-- Then insert:
INSERT INTO admin_users (email, password_hash, name)
VALUES (
  'new-admin@lkdigital.org',
  '$2b$10$YOUR_HASHED_PASSWORD_HERE',
  'Admin Name'
);
```

### Option 2: Using Setup Script

1. Edit `scripts/setup-admin.js`
2. Change `ADMIN_EMAIL`, `ADMIN_PASSWORD`, `ADMIN_NAME`
3. Run: `node scripts/setup-admin.js`
4. Copy generated SQL and run in Supabase

---

## ğŸ”„ Changing Password

### To change the admin password:

1. Edit `scripts/setup-admin.js`:
   ```javascript
   const ADMIN_PASSWORD = 'your-new-password-here';
   ```

2. Run script:
   ```bash
   node scripts/setup-admin.js
   ```

3. Copy the generated SQL (includes new hash)

4. Run SQL in Supabase SQL Editor

âœ… Password updated!

---

## ğŸ§ª Testing

### Test Login:
```bash
curl -X POST http://localhost:3000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "contato@lkdigital.org",
    "password": "K5h3s2#195962"
  }'
```

**Expected Response**:
```json
{
  "success": true,
  "token": "admin_1234567890_abcdef...",
  "user": {
    "id": "...",
    "email": "contato@lkdigital.org",
    "name": "Admin LK Digital"
  }
}
```

---

## âŒ Troubleshooting

### "Email ou senha incorretos"
- âœ… Check email is exactly: `contato@lkdigital.org`
- âœ… Check password is exactly: `K5h3s2#195962`
- âœ… Verify SQL was run successfully in Supabase
- âœ… Check `admin_users` table exists and has the record

### "Erro ao conectar"
- âœ… Verify Supabase connection is working
- âœ… Check network/internet connection
- âœ… Verify API routes are deployed correctly

### Session Expired
- âœ… Login again (session tokens don't persist between browser sessions)
- âœ… Check sessionStorage hasn't been cleared

### Can't Access Dashboard After Login
- âœ… Check browser console for errors
- âœ… Verify analytics API (`/api/admin/analytics`) is working
- âœ… Ensure `ADMIN_DASHBOARD_TOKEN` env variable is still set (used as backup)

---

## ğŸ—„ï¸ Database Schema

```sql
CREATE TABLE admin_users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  name TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  last_login TIMESTAMPTZ
);
```

---

## ğŸ“Š What You Can Access

Once logged in, you'll see:

âœ… **Total & Unique Visitors**  
âœ… **Completed Leads**  
âœ… **Downloads by Plan** (Free, Professional, Premium)  
âœ… **Total Revenue**  
âœ… **Conversion Funnel**  
âœ… **Form Abandonment** (who started but didn't finish)  
âœ… **Recent Leads** (full contact information)  
âœ… **Time Period Filtering** (7/30/90 days)  

---

## ğŸ“ Support

**Email**: contato@lkdigital.org  
**WhatsApp**: +55 11 95282-9271

---

**Last Updated**: 12 de janeiro de 2026  
**Status**: âœ… Ready to Use
